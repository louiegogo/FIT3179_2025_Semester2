<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World Cocoa Production Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    html, body {
      margin: 0;
      font-family: sans-serif;
      background-color: #fafafa;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .map-section {
      flex: 1; /* Top 1/3 */
      border-bottom: 2px solid #ddd;
    }

    .bottom-section {
      flex: 2; /* Bottom 2/3 */
      display: flex;
    }

    .column {
      flex: 1;
      border-right: 2px solid #ddd;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-y: auto;
    }

    .column:last-child {
      border-right: none;
    }

    #map {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      margin: 0 auto;
    }

    .map-text {
      padding: 20px;
      text-align: center;
      max-width: 800px;
      margin: 0 auto;
      color: #444;
      font-size: 1rem;
      line-height: 1.6;
    }

    #trade_chart {
      width: 100%;
      height: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Top third: map -->
    <div class="map-section" id="map"></div>
    <div class="map-text">
      <p>
        The above choropleth map shows world cocoa bean production in 2023.
      </p>
    </div>

    <!-- Bottom two-thirds: 3 columns -->
    <div class="bottom-section">
      <div class="column">
        <h3>Cocoa Trade Chart</h3>
        <div id="trade_chart"></div>
      </div>
      <div class="column">Column 2 [TBD]</div>
      <div class="column">Column 3 [TBD]</div>
    </div>
  </div>

  <script>
    // Choropleth map spec (existing)
    const mapSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 800,
      "height": 400,
      "title": "World Cocoa Production (2023)",
      "projection": {"type": "equirectangular"},
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/louiegogo/FIT3179_2025_Semester2/main/ne_110m_graticules_30.json",
            "format": {"type": "topojson", "feature": "graticule"}
          },
          "mark": {"type": "geoshape", "stroke": "#888", "fill": null}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/ne_110m_admin_0_countries.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "transform": [
            {
              "lookup": "properties.NAME",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/louiegogo/FIT3179_2025_Semester2/refs/heads/main/cocoa_prod_FAOSTAT_data_en_10-14-2025.csv"
                },
                "key": "Area",
                "fields": ["Value"]
              }
            },
            {"calculate": "datum.Value + 1", "as": "production_plus1"}
          ],
          "mark": {"type": "geoshape"},
          "encoding": {
            "color": {
              "field": "production_plus1",
              "type": "quantitative",
              "title": "Cocoa production (tonnes, log scale)",
              "scale": {"type": "log", "scheme": "browns"}
            },
            "tooltip": [
              {"field": "properties.NAME", "type": "nominal", "title": "Country"},
              {"field": "Value", "type": "quantitative", "title": "Production"}
            ]
          }
        }
      ]
    };

    vegaEmbed('#map', mapSpec, {actions: false});

    // Embedded cocoa trade JSON spec (grouped column chart with country filter)
    const tradeSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": "container",
      "height": 300,
      "title": "Cocoa Powder Import vs Export Value (2014–2023)",
      "data": {
        "url": "https://raw.githubusercontent.com/louiegogo/FIT3179_2025_Semester2/refs/heads/main/cocoa_powder_trade_FAOSTAT_data_en_10-14-2025.csv"
      },
      "params": [
        {
          "name": "country_selection",
          "value": "Afghanistan",
          "bind": {
            "input": "select",
            "options": [
              "Afghanistan","Albania","Algeria","Angola","Argentina","Australia","Austria",
              "Bangladesh","Belgium","Brazil","Cameroon","Canada","China","Côte d'Ivoire",
              "Ecuador","France","Ghana","India","Indonesia","Malaysia","Mexico","Netherlands",
              "Nigeria","Peru","Poland","Portugal","Singapore","South Africa","Spain",
              "Switzerland","Thailand","Turkey","United Kingdom","United States","Viet Nam"
            ],
            "name": "Select Country: "
          }
        }
      ],
      "transform": [
        {"filter": "datum.Element == 'Import value' || datum.Element == 'Export value'"},
        {"filter": "datum.Area == country_selection"}
      ],
      "mark": {"type": "bar", "width": {"band": 0.4}},
      "encoding": {
        "x": {"field": "Year", "type": "ordinal", "axis": {"title": "Year"}},
        "y": {"field": "Value", "type": "quantitative", "axis": {"title": "Trade Value (1000 USD)"}},
        "color": {
          "field": "Element",
          "type": "nominal",
          "title": "Trade Type",
          "scale": {"domain": ["Import value", "Export value"], "range": ["#1f77b4","#ff7f0e"]}
        },
        "xOffset": {"field": "Element"},
        "tooltip": [
          {"field": "Area", "type": "nominal"},
          {"field": "Year", "type": "ordinal"},
          {"field": "Element", "type": "nominal"},
          {"field": "Value", "type": "quantitative"}
        ]
      }
    };

    vegaEmbed('#trade_chart', tradeSpec, {actions: false});
  </script>
</body>
</html>

